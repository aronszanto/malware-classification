from collections import Counter
from datetime import datetime


def ff_count_procs(tree):
    return {'num_procs': len(tree.findall('process'))}


def ff_system_call_counts(tree):
    c = Counter()
    for all_section in tree.iter('all_section'):
        for call in all_section.iter():
            c[call.tag] += 1
    return c


def ff_total_runtime_feats(tree):
    total_runtime = 0  # Assumes not multicore

    for process in tree.iter('process'):
        process = tree.find('process')
        start = datetime.strptime(process.get('starttime'), '%M:%S.%f')
        end = datetime.strptime(process.get('terminationtime'), '%M:%S.%f')
        total = end - start
        total_runtime += total.total_seconds()

    return {'total_runtime': total_runtime}


